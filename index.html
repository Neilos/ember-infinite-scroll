<!doctype html>
<html lang="en">
<head>
  <script type='text/javascript' src='javascripts/jquery.js'></script>
  <script type='text/javascript' src='javascripts/handlebars.js'></script>
  <script type='text/javascript' src='javascripts/ember.js'></script>
  <script type='text/javascript' src='javascripts/infinite_scroll.js'></script>

  <script type='text/javascript'>

  var App = Ember.Application.create();

  App.IndexRoute = Ember.Route.extend({
    model: function(){
      var items = Em.A([]);
      for (var i = 0; i < 10; i++) {
        items.pushObject({name: ''+i});
      }
      return items;
    },
    events: $.extend({}, InfiniteScroll.RouteEvents)
  });

  App.IndexController = Ember.ArrayController.extend(
    InfiniteScroll.ControllerMixin,
    {perPage: 10}
  );

  App.IndexView = Ember.View.extend(InfiniteScroll.ViewMixin, {
    didInsertElement: function(){
      this.setupInfiniteScrollListener();
    },
    willDestroyElement: function(){
      this.teardownInfiniteScrollListener();
    }
  });
  </script>
</head>
<body>

<h1>Hi</h1>

<script data-template-name="application" type="text/x-handlebars">
APPLICATION TEMPLATE
{{outlet}}
</script>

<script data-template-name="index" type="text/x-handlebars">
INDEX TEMPLATE

<h2>Widgets ({{model.length}})</h2>
<ul>
  {{#each widget in controller}}
    {{render 'widget' widget}}
  {{/each}}
</ul>

{{#if loadingMore}}
  Loading more...
{{else}}
  <a href='#' {{action 'getMore'}}>Get More...</a>
{{/if}}
</script>

<script data-template-name="widget" type="text/x-handlebars">
  <li>Widget: {{name}}</li>
</script>

</body>
</html>
